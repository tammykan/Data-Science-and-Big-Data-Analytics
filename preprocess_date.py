# Use to preprocess yahoo stock price
# Add weekend price from previous day price
# Only get date and close price
# Usage : python3 getPrice.py filename

import subprocess
import sys
import datetime

filename = sys.argv[1]

COMMAND = "tail -n +2 %s | awk -F \',\' \'{print $1,$5}\' | sed -e 's/ /,/g' > tmp.csv" % filename 
subprocess.call(COMMAND, shell=True)

d = {}
for line in open("./tmp.csv", "r"):
    split = line.strip().split(",")
    d[split[0]] = split[1]

loseday = [
            "2012-11-03", "2012-11-04", "2012-11-10", "2012-11-11", "2012-11-17",
            "2012-11-18", "2012-11-22", "2012-11-24", "2012-11-25", "2012-12-01",
            "2012-12-02", "2012-12-08", "2012-12-09", "2012-12-15", "2012-12-16",
            "2012-12-22", "2012-12-23", "2012-12-25", "2012-12-29", "2012-12-30",
            "2012-12-31", "2013-01-01", "2013-01-05", "2013-01-06", "2013-01-12",
            "2013-01-13", "2013-01-19", "2013-01-20", "2013-01-21", "2013-01-26",
            "2013-01-27", "2013-02-02", "2013-02-03", "2013-02-09", "2013-02-10",
            "2013-02-16", "2013-02-17", "2013-02-18", "2013-02-23", "2013-02-24",
            "2013-03-02", "2013-03-03", "2013-03-09", "2013-03-10", "2013-03-16",
            "2013-03-17", "2013-03-23", "2013-03-24", "2013-03-29", "2013-03-30",
            "2013-03-31", "2013-04-06", "2013-04-07", "2013-04-13", "2013-04-14",
            "2013-04-20", "2013-04-21", "2013-04-27", "2013-04-28", "2013-05-04",
            "2013-05-05", "2013-05-11", "2013-05-12", "2013-05-18", "2013-05-19",
            "2013-05-25", "2013-05-26", "2013-05-27", "2013-06-01", "2013-06-02", 
            "2013-06-08", "2013-06-09", "2013-06-15", "2013-06-16", "2013-06-22", 
            "2013-06-23", "2013-06-29", "2013-06-30"
            ]

losedayprice = [
            "2012-11-02", "2012-11-02", "2012-11-09", "2012-11-09", "2012-11-16",
            "2012-11-16", "2012-11-21", "2012-11-23", "2012-11-23", "2012-11-30",
            "2012-11-30", "2012-12-07", "2012-12-07", "2012-12-14", "2012-12-14",
            "2012-12-21", "2012-12-21", "2012-12-24", "2012-12-28", "2012-12-28",
            "2012-12-28", "2012-12-28", "2013-01-04", "2013-01-04", "2013-01-11",
            "2013-01-11", "2013-01-18", "2013-01-18", "2013-01-18", "2013-01-25",
            "2013-01-25", "2013-02-01", "2013-02-01", "2013-02-08", "2013-02-08",
            "2013-02-15", "2013-02-15", "2013-02-15", "2013-02-22", "2013-02-22",
            "2013-03-01", "2013-03-01", "2013-03-08", "2013-03-08", "2013-03-15",
            "2013-03-15", "2013-03-22", "2013-03-22", "2013-03-28", "2013-03-28",
            "2013-03-28", "2013-04-05", "2013-04-05", "2013-04-12", "2013-04-12",
            "2013-04-19", "2013-04-19", "2013-04-26", "2013-04-26", "2013-05-03",
            "2013-05-04", "2013-05-10", "2013-05-10", "2013-05-17", "2013-05-17",
            "2013-05-24", "2013-05-24", "2013-05-24", "2013-05-31", "2013-05-31", 
            "2013-06-07", "2013-06-07", "2013-06-14", "2013-06-14", "2013-06-21", 
            "2013-06-21", "2013-06-28", "2013-06-28"
            ]
for i, j in zip(loseday, losedayprice):
    d[i] = d.get(j)


with open("result.csv", 'w') as f:
    for key, value in d.items():
        f.write('%s,%s\n' % (key, value))